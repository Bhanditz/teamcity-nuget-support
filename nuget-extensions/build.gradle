import java.nio.file.Paths 

plugins {
    id 'com.ullink.nuget' version '2.14'
    id 'com.ullink.nunit' version '1.8'
}

nugetRestore {
	version = '3.3.0'
    solutionFile = file('nuget-extensions.sln')
}

task msbuild {
	doLast {
	    if (System.properties['os.name'].toLowerCase().contains('windows')) {
			def msbuildExecutable = file('msbuild.exe').getName()
			def msbuildPath = System.getenv()['MSBuildTools4.0_x86_Path']

			if (msbuildPath != null) {
				msbuildPath = msbuildPath.replaceAll("\"", "")
				msbuildExecutable = Paths.get(msbuildPath, msbuildExecutable)
			}
				
	        exec {
				 commandLine msbuildExecutable, "nuget-extensions.sln", "/t:Clean,Rebuild", "/p:Configuration=Release"
	    	}	
		}
		else {
			exec {
				commandLine "xbuild", "nuget-extensions.sln", "/p:Configuration=Release"
		    }	
		}
	}
}

msbuild.dependsOn nugetRestore

nunit.dependsOn msbuild
nunit {
    nunitVersion = '3.0.1'
    useX86 = true
}
